<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å«æ°Ÿæ°”ä½“å†å²æ’æ”¾æ•°æ®åº“</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    
    <style>
        /* --- CSS å˜é‡å®šä¹‰é…è‰²æ–¹æ¡ˆ --- */
        :root {
            --primary-color: #2c7be5;   /* ä¸»è‰²è°ƒï¼šä¸“ä¸šè“ */
            --secondary-color: #1a4d8c; /* æ·±è“è‰² */
            --accent-color: #00d97e;    /* ç‚¹ç¼€è‰²ï¼šæ¸…æ–°ç»¿ */
            --bg-light: #f4f7f9;        /* ç½‘é¡µèƒŒæ™¯ç° */
            --text-dark: #2d3748;       /* æ·±è‰²æ–‡å­— */
            --text-gray: #718096;       /* ç°è‰²æ–‡å­— */
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* å¡ç‰‡é˜´å½± */
        }

        /* --- å…¨å±€æ ·å¼é‡ç½® --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
        }

        /* --- 1. å¤´éƒ¨ Header (Hero Section) --- */
        .site-header {
            /* æ¸å˜èƒŒæ™¯ */
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            color: white;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: -60px; /* è®©ä¸‹æ–¹çš„å¡ç‰‡å‘ä¸Šé‡å ï¼Œåˆ¶é€ å±‚æ¬¡æ„Ÿ */
            padding-bottom: 80px;
        }
        .site-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }
        .site-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 300;
        }

        /* --- ä¸»å†…å®¹å®¹å™¨ --- */
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* --- 2. å¡ç‰‡å¼å¸ƒå±€æ ¸å¿ƒ --- */
        .dashboard-card {
            background: white;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            padding: 30px;
            margin-bottom: 40px;
            position: relative; /* ä¸ºäº†é…åˆ header çš„è´Ÿè¾¹è· */
        }

        /* --- 3. æ§åˆ¶é¢æ¿æ ·å¼å‡çº§ --- */
        .controls-header {
            text-align: center;
            margin-bottom: 25px;
            color: var(--text-gray);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.9em;
            letter-spacing: 1px;
        }
        .controls-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px; /* æ§ä»¶é—´è· */
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 1px solid #eee; /* åˆ†éš”çº¿ */
            flex-wrap: wrap;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 220px;
        }
        .control-group label {
            font-size: 0.95em;
            font-weight: 700;
            color: var(--text-dark);
            display: flex;
            align-items: center;
        }
        /* åœ¨æ ‡ç­¾å‰åŠ ä¸€ä¸ªå°å›¾æ ‡è£…é¥° */
        .control-group label::before {
            content: '';
            display: inline-block;
            width: 4px; height: 16px;
            background-color: var(--primary-color);
            margin-right: 8px;
            border-radius: 2px;
        }
        /* ç¾åŒ–ä¸‹æ‹‰æ¡† */
        select {
            padding: 12px 16px;
            font-size: 16px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            background-color: #f8fafc;
            color: var(--text-dark);
            cursor: pointer;
            transition: all 0.3s ease;
            appearance: none; /* ç§»é™¤åŸç”Ÿæ ·å¼ï¼Œæ–¹ä¾¿è‡ªå®šä¹‰ç®­å¤´(è¿™é‡Œç®€åŒ–å¤„ç†æœªåŠ è‡ªå®šä¹‰ç®­å¤´å›¾ç‰‡) */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%232c7be5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 18px;
            padding-right: 40px;
        }
        select:hover { border-color: var(--primary-color); }
        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(44, 123, 229, 0.2);
        }

        /* --- å›¾è¡¨å®¹å™¨ --- */
        #chart-container {
            width: 100%;
            height: 600px;
            /* ç§»é™¤æ—§è¾¹æ¡†ï¼Œå› ä¸ºç°åœ¨åœ¨å¡ç‰‡é‡Œäº† */
        }

        /* --- é¡µè„š --- */
        .footer {
            text-align: center;
            padding: 20px 0;
            color: var(--text-gray);
            font-size: 0.9em;
            border-top: 1px solid #eee;
            margin-top: 20px;
        }
        .download-link {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            transition: color 0.2s;
        }
        .download-link:hover { color: var(--secondary-color); }
    </style>
</head>
<body>

    <header class="site-header">
        <div class="container">
            <h1 class="site-title">å«æ°Ÿæ°”ä½“å†å²æ’æ”¾æ•°æ®åº“</h1>
            <p class="site-subtitle">å…¨çƒ/åŒºåŸŸå¤šæºæ•°æ®äº¤äº’å¼å¯è§†åŒ–åˆ†æå¹³å°</p>
        </div>
    </header>

    <main class="container">
        <section class="dashboard-card">
            
            <div class="controls-header">â€”â€” æ•°æ®ç­›é€‰æ§åˆ¶å™¨ â€”â€”</div>

            <div class="controls-container">
                <div class="control-group">
                    <label for="region-select">ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©åŒºåŸŸ (Region)</label>
                    <select id="region-select">
                        <option value="">æ­£åœ¨åŠ è½½åŒºåŸŸæ•°æ®...</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="substance-select">ç¬¬äºŒæ­¥ï¼šé€‰æ‹©ç‰©è´¨ (Substance)</label>
                    <select id="substance-select">
                        <option value="">æ­£åœ¨åŠ è½½ç‰©è´¨åˆ—è¡¨...</option>
                    </select>
                </div>
            </div>

            <div id="chart-container"></div>

            <footer class="footer">
                Â© 2026 å«æ°Ÿæ°”ä½“æ•°æ®åº“è®¡åˆ’ | æ•°æ®æ¥æºï¼šå¤šæºå…¬å¼€æ•°æ®åº“æ•´ç† | 
                <a href="data.csv" download class="download-link">
                    <span style="margin-right: 5px; font-size: 1.2em;">ğŸ“¥</span> ä¸‹è½½æºæ•°æ® (CSV)
                </a>
            </footer>
        </section>
    </main>

    <script>
        var myChart = echarts.init(document.getElementById('chart-container'));
        var globalData = []; var distinctYears = [];
        myChart.showLoading({ text: 'æ•°æ®åº“è¿æ¥ä¸­...', color: '#2c7be5', textColor: '#2c7be5', maskColor: 'rgba(255, 255, 255, 0.9)' });

        Papa.parse("data.csv?t=" + new Date().getTime(), {
            download: true, header: true, dynamicTyping: true, skipEmptyLines: true,
            complete: function(results) {
                myChart.hideLoading();
                var rawData = results.data;
                var columns = results.meta.fields.map(function(col) { return col.trim().replace(/^\ufeff/, ''); });
                if (results.meta.fields[0] !== columns[0]) {
                    rawData = rawData.map(row => { var newRow = {}; results.meta.fields.forEach((oldKey, i) => newRow[columns[i]] = row[oldKey]); return newRow; });
                }
                if (!columns.includes("Source") || !columns.includes("Year") || !columns.includes("Region")) { alert("CSVæ ¼å¼é”™è¯¯ï¼"); return; }
                globalData = rawData;
                var yearsSet = new Set(rawData.map(row => row.Year));
                distinctYears = Array.from(yearsSet).sort((a, b) => a - b);
                var substances = columns.filter(col => col !== "Year" && col !== "Source" && col !== "Region");
                initSelectors(substances);
            },
            error: function(err) { alert("æ— æ³•è¯»å– data.csvã€‚"); }
        });

        function initSelectors(substances) {
            var regionSelect = document.getElementById('region-select');
            var substanceSelect = document.getElementById('substance-select');
            var regions = Array.from(new Set(globalData.map(row => row.Region))).sort();
            regionSelect.innerHTML = "";
            regions.forEach(r => { var opt = document.createElement("option"); opt.value = r; opt.text = r; regionSelect.appendChild(opt); });
            substanceSelect.innerHTML = "";
            substances.forEach(s => { var opt = document.createElement("option"); opt.value = s; opt.text = s; substanceSelect.appendChild(opt); });
            regionSelect.addEventListener('change', updateChart);
            substanceSelect.addEventListener('change', updateChart);
            updateChart(); 
        }

        function updateChart() {
            var selectedRegion = document.getElementById('region-select').value;
            var selectedSubstance = document.getElementById('substance-select').value;
            if (!selectedRegion || !selectedSubstance) return;
            var regionData = globalData.filter(row => row.Region === selectedRegion);
            var sources = Array.from(new Set(regionData.map(row => row.Source)));
            var seriesData = sources.map(sourceName => {
                var sourceRows = regionData.filter(row => row.Source === sourceName);
                var dataPoints = distinctYears.map(year => {
                    var row = sourceRows.find(r => r.Year === year);
                    return row ? row[selectedSubstance] : null;
                });
                return {
                    name: sourceName, type: 'line', smooth: true, data: dataPoints, symbolSize: 10, lineStyle: { width: 3 }
                };
            });

            // æ›´æ–°äº†å›¾è¡¨é…ç½®çš„æ ·å¼ï¼Œä½¿å…¶æ›´åŒ¹é…æ–°ä¸»é¢˜
            var option = {
                // æ ‡é¢˜ç§»é™¤äº†ï¼Œå› ä¸ºé¡µé¢é¡¶éƒ¨å·²ç»æœ‰äº†å¤§æ ‡é¢˜
                tooltip: { 
                    trigger: 'axis',
                    backgroundColor: 'rgba(255,255,255,0.95)',
                    borderColor: '#eee',
                    borderWidth: 1,
                    textStyle: { color: '#333' },
                    axisPointer: { lineStyle: { color: '#999' } }
                },
                legend: { data: sources, bottom: 0, padding: 20, itemGap: 20, textStyle: { fontSize: 14 } },
                grid: { left: '5%', right: '5%', bottom: '15%', top: '8%', containLabel: true },
                xAxis: { 
                    type: 'category', name: 'å¹´ä»½', data: distinctYears,
                    axisLine: { lineStyle: { color: '#ccc' } },
                    axisLabel: { color: '#666', fontSize: 13 }
                },
                yAxis: { 
                    type: 'value', name: 'æ’æ”¾é‡ (å¨/CO2e)',
                    axisLine: { show: false },
                    axisTick: { show: false },
                    splitLine: { lineStyle: { color: '#eee', type: 'dashed' } },
                    nameTextStyle: { color: '#666', padding: [0, 0, 10, 0] }
                },
                series: seriesData,
                color: ['#2c7be5', '#00d97e', '#f6c23e', '#e74a3b', '#36b9cc'] // ä½¿ç”¨äº†æ–°çš„é…è‰²ç›˜
            };
            myChart.setOption(option, true);
        }
        window.addEventListener('resize', () => myChart.resize());
    </script>
</body>
</html>
